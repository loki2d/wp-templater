#Notification - уведомления о новых сообщениях в трансляции

##Цель
Уведомления служат для того, что бы довести до пользователя информацию о новых
сообщениях в трансляции.

##Как работает
Через сокет соединение можно отправлять !всем! активным пользователям уведомление через протокол wapm.

В уведомлении на клиент приходит id трансляции.
Клиент проверяет есть ли в localstorage данные об этой трансляции, если нет -
делает запрос к серверу и получает следующие json объект:

```
{
  id : "",
  url: "",
  img: "",
  title : "",
}
```

id - num идентификатор запрашиваемой трансляции
url - str  ссылка на интересующую трансляцию
img - str обложка основной статьи к которой приписана данная трансляция
title - str заголовок статьи к которой приписана трансляция.

Когда ответ от сервера будет получен, заполняем объект в localstorage

```
notifications : [
  123443214 : {
    id : 123443214,
    url : "http://www.kp.ru/daily/26571/3587606/",
    img : "http://s15.stc.all.kpcdn.net/share/i/12/9819459/",
    title: "Крым подаст в суд на Украину за «два десятилетия грабежа",
    count: 1,
    active : true
  ]
}
```
notifications - массив объектов уведомлений
123443214 - объект уведомления
id - id уведомления совпадает с названием объекта
url, title - заполняются из объекта запрошенного с сервера без изменений
img - формируется посредствам [Стриминга изображения](http://teamwork.dev.kp.ru/projects/mobile/wiki/Striming) на основе свойства img пришедшего с сервера объекта.
count - счетчик сообщений добавленных в трансляцию, он увеличивается каждый раз когда приходит пуш-уведомление с сервера с соответсвующие id трансляции.
active - состояние плашки уведомления в браузере пользователя. true если уведомление отрисовано, false если закрыто.

Если сервер данные в localstorage о трансляции уже есть - увеличиваем счетчик сообщений на 1.

Отрисовываем уведомление

## Виды уведомлений и их действия в различных ситуациях

Внешний вид уведомлений на всех страницах сайта один и тот же, отличается они лишь поведением при нажатии на заголовок.

Всего разработано 2 вида поведения уведомлений (планируется еще 1).

* Пользователь находится на любой другой странице сайта.
* Пользователь находится на странице с трансляцией.
* [Пользователь подписал браузер на уведомления].

### Пользователь находится на другой странице сайта
Если пользователь находится на станице сайта отличной от страницы трансляции мы просто перебрасываем его на статью к которой привязана трансляция.

При этом счетчик уведомлений на трансляцию в localstorage сбрасывается и маркер активности переключается в false.

### Пользователь находится на странице трансляции.
Если пользователь кликает в область уведомления (кроме крестика) находясь на странице трансляции:
* клиент отправляет запрос к серверу чтобы получить последние n сообщений из списка сообщений трансляции.
* плавно переносит пользователя к точке отрисовки сообщений.
** пока ждем ответ от сервера рисуем прелодер.
** когда данные получены, убиваем прелодер, отрисовываем сообщения.

При этом счетчик уведомлений на трансляцию в localstorage сбрасывается и маркер активности переключается в false.


## Частные случаи
Если уведомление активно (пользователь не закрыл его и не перешел на трансляцию).

Ищем контейнер уведомления и меняем количество уведомлений при этом создавая визуальный привлекающий внимание. Так же увеличиваем count в объекте localstorage.
